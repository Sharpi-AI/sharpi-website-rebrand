---
import ChatIcon from "@/components/icons/chat.astro";
import AudioIcon from "@/components/icons/audio.astro";
import FileIcon from "@/components/icons/file.astro";

import ArrowRightIcon from "@/components/icons/arrow-right.astro";
---

<div
  class="flex md:hidden gap-3 items-center w-full max-w-7xl mx-auto justify-center"
  data-component="horizontal-selector-mobile"
>
  <div
    class="flex-1 bg-[#f8f8f8] flex items-center justify-start
           h-[62px] px-2.5 py-2.5 rounded-xl cursor-pointer
           transition-all duration-300"
    data-selector-button="conversa"
    data-active="true"
  >
    <div class="flex gap-3 items-center w-fit">
      <div
        class="bg-[#e7e4ff] flex items-center justify-center rounded-md size-[42px] shrink-0"
      >
        <ChatIcon class="size-6 text-[#573dff]" />
      </div>
      <div
        class="block font-normal text-[19px] text-[#573dff] tracking-[-0.38px] leading-[0.9] whitespace-nowrap transition-all duration-200"
      >
        Conversa
      </div>
    </div>
  </div>

  <div
    class="bg-[#f8f8f8] flex items-center justify-start h-[62px] px-2.5 py-2.5 rounded-xl cursor-pointer transition-all duration-300"
    data-selector-button="audio"
    data-active="false"
  >
    <div class="flex gap-3 items-center">
      <div
        class="bg-[#e7e7e7] flex items-center justify-center rounded-md size-[42px] shrink-0"
      >
        <AudioIcon class="size-6 text-neutral-600" />
      </div>
      <div
        class="hidden font-normal text-[19px] text-neutral-600 tracking-[-0.38px] leading-[0.9] whitespace-nowrap transition-all duration-200"
      >
        Áudio
      </div>
    </div>
  </div>

  <div
    class="bg-[#f8f8f8] flex items-center justify-start h-[62px] px-2.5 py-2.5 rounded-xl cursor-pointer transition-all duration-300"
    data-selector-button="files"
    data-active="false"
  >
    <div class="flex gap-3 items-center">
      <div
        class="bg-[#e7e7e7] flex items-center justify-center rounded-md size-[42px] shrink-0"
      >
        <FileIcon class="size-6 text-neutral-600" />
      </div>
      <div
        class="hidden font-normal text-[19px] text-neutral-600 tracking-[-0.38px] leading-[0.9] whitespace-nowrap transition-all duration-200"
      >
        Arquivos Complexos
      </div>
    </div>
  </div>
</div>

<div
  class="hidden md:flex gap-3 items-center w-full max-w-7xl mx-auto"
  data-component="horizontal-selector"
>
  <div
    class="flex-1 bg-[#f8f8f8] flex flex-col gap-2.5 h-[62px] items-start px-2.5 py-2.5 rounded-xl cursor-pointer transition-all duration-200 hover:bg-gray-50"
    data-selector-button="conversa"
    data-active="true"
  >
    <div class="flex gap-2.5 items-center w-full">
      <div
        class="bg-[#e7e4ff] flex items-center justify-center rounded-md size-[42px] shrink-0"
      >
        <ChatIcon class="size-6 text-[#573dff]" />
      </div>

      <div
        class="flex flex-col justify-center font-normal text-[19px] text-[#573dff] tracking-[-0.38px] leading-[0.9] whitespace-nowrap"
      >
        Conversa
      </div>

      <ArrowRightIcon class="shrink-0 size-5" />

      <div class="flex gap-2.5 items-center justify-center">
        <div
          class="font-normal text-[19px] text-[#573dff] tracking-[-0.38px] leading-[0.9]"
        >
          Pedido
        </div>
      </div>
    </div>
  </div>

  <div
    class="flex-1 bg-[#f8f8f8] flex flex-col gap-2.5 h-[62px] items-start px-2.5 py-2.5 rounded-xl cursor-pointer transition-all duration-200 hover:bg-gray-50"
    data-selector-button="audio"
    data-active="false"
  >
    <div class="flex gap-2.5 items-center w-full">
      <div
        class="bg-[#e7e7e7] flex items-center justify-center rounded-md size-[42px] shrink-0"
      >
        <AudioIcon class="size-6 text-neutral-600" />
      </div>

      <div
        class="flex flex-col justify-center font-normal text-[19px] text-neutral-600 tracking-[-0.38px] leading-[0.9] whitespace-nowrap"
      >
        Áudio
      </div>

      <ArrowRightIcon class="hidden shrink-0" />

      <div class="flex gap-2.5 items-center justify-center opacity-0">
        <div
          class="font-normal text-[19px] text-[#573dff] tracking-[-0.38px] leading-[0.9]"
        >
          Pedido
        </div>
      </div>
    </div>
  </div>

  <div
    class="flex-1 bg-[#f8f8f8] flex flex-col gap-2.5 h-[62px] items-start px-2.5 py-2.5 rounded-xl cursor-pointer transition-all duration-200 hover:bg-gray-50"
    data-selector-button="files"
    data-active="false"
  >
    <div class="flex gap-2.5 items-center w-full">
      <div
        class="bg-[#e7e7e7] flex items-center justify-center rounded-md size-[42px] shrink-0"
      >
        <FileIcon class="size-6 text-neutral-600" />
      </div>

      <div
        class="flex flex-col justify-center font-normal text-[19px] text-neutral-600 tracking-[-0.38px] leading-[0.9] whitespace-nowrap"
      >
        Arquivos Complexos
      </div>

      <ArrowRightIcon class="hidden shrink-0" />

      <div class="flex gap-2.5 items-center justify-center opacity-0">
        <div
          class="font-normal text-[19px] text-[#573dff] tracking-[-0.38px] leading-[0.9]"
        >
          Pedido
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const initHorizontalSelector = () => {
    const selectorButtons = document.querySelectorAll<HTMLElement>(
      "[data-selector-button]"
    );

    if (selectorButtons.length === 0) return;

    const isMobileButton = (button: HTMLElement): boolean => {
      const container = button.querySelector("div") as HTMLElement;
      return container?.children.length === 2;
    };

    const updateButtonState = (button: HTMLElement, isActive: boolean) => {
      const container = button.querySelector("div") as HTMLElement;
      if (!container) return;

      const iconContainer = container.children[0] as HTMLElement;
      const label = container.children[1] as HTMLElement;
      const iconSvg = iconContainer?.querySelector("svg") as SVGElement;

      if (isMobileButton(button)) {
        if (isActive) {
          button.className =
            "flex-1 bg-[#f8f8f8] flex items-center justify-start h-[62px] px-2.5 py-2.5 rounded-xl  cursor-pointer transition-all duration-300";
          iconContainer.className =
            "bg-[#e7e4ff] flex items-center justify-center rounded-md size-[42px] shrink-0";
          iconSvg?.setAttribute("class", "size-6 text-[#573dff]");
          label.className =
            "block font-normal text-[19px] text-[#573dff] tracking-[-0.38px] leading-[0.9] whitespace-nowrap transition-all duration-200";
        } else {
          button.className =
            "bg-[#f8f8f8] flex items-center justify-start h-[62px] px-2.5 py-2.5 rounded-xl  cursor-pointer transition-all duration-300";
          iconContainer.className =
            "bg-[#e7e7e7] flex items-center justify-center rounded-md size-[42px] shrink-0";
          iconSvg?.setAttribute("class", "size-6 text-neutral-600");
          label.className =
            "hidden font-normal text-[19px] text-neutral-600 tracking-[-0.38px] leading-[0.9] whitespace-nowrap transition-all duration-200";
        }
      } else {
        const arrow = container.children[2] as SVGElement;
        const pedidoSection = container.children[3] as HTMLElement;

        if (isActive) {
          iconContainer.className =
            "bg-[#e7e4ff] flex items-center justify-center rounded-md size-[42px] shrink-0";
          iconSvg?.setAttribute("class", "size-6 text-[#573dff]");
          label.className =
            "flex flex-col justify-center font-normal text-[19px] text-[#573dff] tracking-[-0.38px] leading-[0.9] whitespace-nowrap";
          arrow?.setAttribute("class", "size-5 text-[#573dff] shrink-0");
          pedidoSection.className = "flex gap-2.5 items-center justify-center ";
        } else {
          iconContainer.className =
            "bg-[#e7e7e7] flex items-center justify-center rounded-md size-[42px] shrink-0";
          iconSvg?.setAttribute("class", "size-6 text-neutral-600");
          label.className =
            "flex flex-col justify-center font-normal text-[19px] text-neutral-600 tracking-[-0.38px] leading-[0.9] whitespace-nowrap";
          arrow?.setAttribute("class", "hidden shrink-0");
          pedidoSection.className =
            "flex gap-2.5 items-center justify-center opacity-0 ";
        }
      }

      button.setAttribute("data-active", isActive ? "true" : "false");
      button.setAttribute("aria-pressed", isActive ? "true" : "false");
    };

    selectorButtons.forEach((button) => {
      button.addEventListener("click", (e) => {
        e.preventDefault();

        const clickedType = button.getAttribute("data-selector-button");

        selectorButtons.forEach((btn) => {
          const btnType = btn.getAttribute("data-selector-button");
          updateButtonState(btn, btnType === clickedType);
        });

        document.dispatchEvent(
          new CustomEvent("howToSelectorChanged", {
            detail: { activeSelector: clickedType },
          })
        );
      });

      button.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          button.click();
        }
      });

      button.setAttribute("tabindex", "0");
      button.setAttribute("role", "button");

      const isActive = button.getAttribute("data-active") === "true";
      button.setAttribute("aria-pressed", isActive ? "true" : "false");
      updateButtonState(button, isActive);
    });
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initHorizontalSelector);
  } else {
    initHorizontalSelector();
  }
</script>
